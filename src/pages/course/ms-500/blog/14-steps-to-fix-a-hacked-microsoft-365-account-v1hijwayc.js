/* eslint react/jsx-no-undef: "off", no-tabs: "off", no-irregular-whitespace: "off" */
import {h, Component} from 'preact'
import Page from '../../../../components/page'
import Container from '@mui/material/Container'
import Grid from '@mui/material/Grid'

const marginTop24Style = {
  marginTop: '24px'
}

class ArticlePage extends Component {
  constructor(props) {
    super(props)
    this.mountAds1 = this.mountAds1.bind(this)
    this.mountAds2 = this.mountAds2.bind(this)

    this.state = {
      article: {article: {blocks: [{data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'bqkr9', text: '', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 0, length: 1, offset: 0}], inlineStyleRanges: [], key: '6ie0b', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '9bk1i', text: 'The first 6 steps are all about getting the malicious actor out of the account. The next 5 steps are all about undoing the damage that was done to your Microsoft 365 tenant. The final 3 steps are all about hardening the account so it doesn\'t happen again. Here\'s a quick checklist you can use to lock out the hacker. Then you can scroll down to the appropriate section to learn how / why to perform the steps.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '9rfvk', text: 'Reset account password', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '2eo9b', text: 'Sign out of all sessions', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '2i7m5', text: 'Remove the account from admin roles', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'dmf79', text: 'Re-enroll MFA', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '8l2je', text: 'Check for enterprise apps authorized for the user', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '7g6mp', text: 'Scan devices for malware', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '8ojao', text: 'Review mailbox rules', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '90fjb', text: 'Review mail forwarding', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '6vga3', text: 'Move any emails that were deleted/moved to a new folder', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'bevf', text: 'Review audit logs for any other unusual activity', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '8niqg', text: 'Unblock the account to allow sending emails', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '1pq9t', text: 'Enable MFA', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'acnr5', text: 'Review email apps and change availability', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'a1r00', text: 'Review sign-in logs and check for additional security measures you can take', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'a71fq', text: '1. Reset account password', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'fqtpq', text: 'First and foremost is locking the hacker out of the account. Reset the password! If it\'s a cloud-only account you can reset the user password right from the Microsoft 365 admin center. If it\'s a synced account you\'ll need to reset the password from your on-premises Active Directory.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 1, length: 12, offset: 43}], inlineStyleRanges: [{length: 26, offset: 6, style: 'BOLD'}, {length: 6, offset: 35, style: 'BOLD'}, {length: 12, offset: 43, style: 'BOLD'}], key: '58rug', text: 'Go to Microsoft 365 admin center > Users > Active Users.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 19, offset: 0, style: 'BOLD'}], key: '1dsrr', text: 'Search for the user you want to reset the password for.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 10, style: 'BOLD'}], key: '7vius', text: 'Click the Display name of the account.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 14, offset: 6, style: 'BOLD'}], key: 'cgfof', text: 'Click Reset password.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 14, offset: 51, style: 'BOLD'}], key: '6l67t', text: 'Set the password/options as you feel fit and click Reset password.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [{key: 2, length: 1, offset: 0}], inlineStyleRanges: [], key: '4jdir', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '4rg2j', text: ' 2. Sign out of all sessions', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '279oc', text: 'In short, a session is created every time a user signs into Microsoft 365 on any device/app. What happens is the user will provide the username/password. Microsoft will authorize the connection and then create a session. The device or app will receive an identifying key. Microsoft 365 will hold that key on their end to authorize the app every time the app wants to interact with Microsoft 365. That way the app doesn\'t need to send the password every time it is communicating with Microsoft 365. Disconnecting all the user\'s sessions will require the user to sign in on all their devices and apps again.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 1, length: 12, offset: 43}], inlineStyleRanges: [{length: 26, offset: 6, style: 'BOLD'}, {length: 6, offset: 35, style: 'BOLD'}, {length: 12, offset: 43, style: 'BOLD'}], key: '7g73l', text: 'Go to Microsoft 365 admin center > Users > Active Users.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 19, offset: 0, style: 'BOLD'}], key: 'ali6d', text: 'Search for the user you want to reset the password for.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 10, style: 'BOLD'}], key: '7ib8u', text: 'Click the Display name of the account.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '3aa9f', text: 'Click Sign out of all sessions.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [{key: 3, length: 1, offset: 0}], inlineStyleRanges: [], key: '25tcf', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'edgnr', text: '3. Remove the account from admin roles', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '5ie0n', text: 'Next, we may want to remove the account from any admin roles. It\'s good practice to temporarily remove the account from any admin roles until you are 100% sure the compromised account is no longer accessed by the hacker.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 1, length: 12, offset: 43}], inlineStyleRanges: [{length: 26, offset: 6, style: 'BOLD'}, {length: 6, offset: 35, style: 'BOLD'}, {length: 12, offset: 43, style: 'BOLD'}], key: 'bo1se', text: 'Go to Microsoft 365 admin center > Users > Active Users.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 19, offset: 0, style: 'BOLD'}], key: '33bm5', text: 'Search for the user you want to reset the password for.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 10, style: 'BOLD'}], key: '648kn', text: 'Click the Display name of the account.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 6, style: 'BOLD'}, {length: 29, offset: 21, style: 'BOLD'}, {length: 12, offset: 53, style: 'BOLD'}], key: 'bosq1', text: 'Click Manage roles > User (no admin center access) > Save changes.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [{key: 4, length: 1, offset: 0}], inlineStyleRanges: [], key: 'bk0e2', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '34b4j', text: '4. Re-enroll in MFA', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'c9ugj', text: 'If you have MFA enabled for the user you may want to re-enroll the devices or at least review the devices and make sure they are the user\'s devices. In short, once a malicious user has access to the user\'s Microsoft 365 account they can enroll their own devices and possibly reset the password after you\'ve changed the password. So go to the user\'s MFA authentication methods and sit down with the user and ask if that\'s their authentication method.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 5, length: 5, offset: 31}], inlineStyleRanges: [{length: 22, offset: 6, style: 'BOLD'}, {length: 5, offset: 31, style: 'BOLD'}, {length: 19, offset: 74, style: 'BOLD'}], key: 'f6sis', text: 'Go to Azure Active Directory > Users. Search for the user, then click the user\'s display name.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 22, offset: 6, style: 'BOLD'}], key: '3k8fv', text: 'Click Authentication methods then view the user\'s authentication methods.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [{key: 6, length: 1, offset: 0}], inlineStyleRanges: [], key: 'd58hj', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '29s1f', text: '5. Check for enterprise apps authorized for the user', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'd6b7g', text: 'Another way a malicious actor may retain access to your user\'s Microsoft 365 account is through enterprise apps. In short, once a person has access to the account they may register the user for a malicious enterprise app that the hacker can use to retain access to the account after the password reset. So we\'ll need to review the registered apps for the user.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 7, length: 1, offset: 0}], inlineStyleRanges: [], key: '3nu3b', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [{key: 8, length: 5, offset: 31}], inlineStyleRanges: [{length: 22, offset: 6, style: 'BOLD'}, {length: 5, offset: 31, style: 'BOLD'}, {length: 6, offset: 39, style: 'BOLD'}, {length: 6, offset: 55, style: 'BOLD'}, {length: 11, offset: 65, style: 'BOLD'}], key: '7rhek', text: 'Go to Azure Active Directory > Users > Search for then click the user\'s name.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 6, style: 'BOLD'}], key: '7lp43', text: 'Click Applications.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 5, offset: 0, style: 'BOLD'}, {length: 4, offset: 17, style: 'BOLD'}], key: '3p9pt', text: 'Sort the list by date.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 13, offset: 0, style: 'BOLD'}], key: '9thrp', text: 'Find any apps that were registered since the hacker gained access to the account.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 8, offset: 10, style: 'BOLD'}], key: '9alek', text: 'Click the app name.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 6, offset: 6, style: 'BOLD'}], key: 'boejr', text: 'Click Remove.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'ehjaf', text: '6. Scan devices for malware', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'rkbf', text: 'It isn\'t very common but I have had an issue where we cleaned the Microsoft 365 account, changed the password, unblocked the account, and then had the malicious actor back in the account! How did they do it? They had malware on the user\'s computer. So be sure to scan all the user\'s devices for malware. Check for any weird apps in the startup of the computer and check for any strange services.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '3at3m', text: '7. Review mailbox inbox rules', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '8tvt4', text: 'One this hackers like to do once they gain access to one of your mailboxes is send a lot of phishing/spam emails. Of course, sending these emails will return a lot of undeliverable emails and emails from recipients saying things like "Is this legit?". So One of the ways hackers found to cover their tracks is by creating a mail flow rule that will automatically delete any emails the user receives. There are 2 ways to check for the rules, using the GUI or using PowerShell. Typically, people find the GUI to be more readable so we\'ll use that route below. First, you\'ll need to grant yourself full access to the mailbox. Then, you\'ll need to check for the inbox rules. Finally, you\'ll need to remove your full access to the mailbox.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'cosq5', text: 'Grant yourself admin rights to the mailbox', type: 'header-three'}, {data: {}, depth: 0, entityRanges: [{key: 9, length: 1, offset: 0}], inlineStyleRanges: [], key: 'alclf', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [{key: 10, length: 9, offset: 46}], inlineStyleRanges: [{length: 21, offset: 9, style: 'BOLD'}, {length: 11, offset: 33, style: 'BOLD'}, {length: 9, offset: 46, style: 'BOLD'}], key: 'ckv47', text: 'Open the Exchange admin center > Recipients > Mailboxes.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 7, offset: 0, style: 'BOLD'}, {length: 5, offset: 15, style: 'BOLD'}, {length: 12, offset: 25, style: 'BOLD'}], key: '3vi0b', text: 'Search for and click the Display Name of the user that\'s been compromised.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 11, offset: 6, style: 'BOLD'}, {length: 5, offset: 19, style: 'BOLD'}], key: '5u2rc', text: 'Click Delegation > Edit (located under Read and manage)', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 11, offset: 6, style: 'BOLD'}, {length: 9, offset: 30, style: 'BOLD'}, {length: 13, offset: 52, style: 'BOLD'}, {length: 4, offset: 73, style: 'BOLD'}], key: 'bmeho', text: 'Click Add members > Click the checkbox next to your admin account. Click Save.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '588kq', text: 'Check the inbox rules', type: 'header-three'}, {data: {}, depth: 0, entityRanges: [{key: 11, length: 1, offset: 0}], inlineStyleRanges: [], key: '9m8ho', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [{key: 12, length: 11, offset: 5}], inlineStyleRanges: [{length: 12, offset: 30, style: 'BOLD'}, {length: 20, offset: 67, style: 'BOLD'}], key: 'atq62', text: 'Open Outlook OWA > Click your profile icon in the top right. Click Open another mailbox.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 16, style: 'BOLD'}, {length: 5, offset: 60, style: 'BOLD'}, {length: 8, offset: 85, style: 'BOLD'}, {length: 4, offset: 101, style: 'BOLD'}], key: '3hii9', text: 'Type the user\'s display name in the box provided. Click the user that appears in the dropdown. Click Open.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 9, offset: 10, style: 'BOLD'}, {length: 25, offset: 43, style: 'BOLD'}], key: '7tjjj', text: 'Click the settings gear in the top right > View all Outlook settings.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 6, offset: 6, style: 'BOLD'}, {length: 6, offset: 24, style: 'BOLD'}, {length: 2, offset: 84, style: 'BOLD'}], key: 'bt2ob', text: 'Go to Rules > Click the trash can next to every rule that you want to delete. Click OK.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '5aoa8', text: 'Before you remove your delegated permissions you should check for mail forwarding. The steps are below.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '7be45', text: '8. Review mail forwarding', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'fdf4j', text: 'Another thing hackers like to do when they gain access to your mailbox is set up mail forwarding. In short, they may use your account to send phishing attacks to other organizations and request information from other people. So we\'ll need to disable any mail forwarding the hacker has set up.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 13, length: 1, offset: 0}], inlineStyleRanges: [], key: 'bjs01', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [{key: 12, length: 11, offset: 5}], inlineStyleRanges: [{length: 12, offset: 30, style: 'BOLD'}, {length: 20, offset: 67, style: 'BOLD'}], key: '79stg', text: 'Open Outlook OWA > Click your profile icon in the top right. Click Open another mailbox.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 16, style: 'BOLD'}, {length: 5, offset: 60, style: 'BOLD'}, {length: 8, offset: 85, style: 'BOLD'}, {length: 4, offset: 101, style: 'BOLD'}], key: '2lnnl', text: 'Type the user\'s display name in the box provided. Click the user that appears in the dropdown. Click Open.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 9, offset: 10, style: 'BOLD'}, {length: 25, offset: 43, style: 'BOLD'}], key: '8e7k5', text: 'Click the settings gear in the top right > View all Outlook settings.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 11, offset: 6, style: 'BOLD'}, {length: 25, offset: 19, style: 'BOLD'}, {length: 4, offset: 52, style: 'BOLD'}], key: '92s94', text: 'Click Forwarding > uncheck Enable forwarding. Click Save.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'bi3bd', text: 'Don\'t remove those permissions just yet. If you did find an inbox rule or a forwarding rule we\'ll need to undo the damage!', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '1ptk2', text: '9. Move any emails that were deleted/moved to a new folder', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'nuid', text: 'In short, you\'ll need to move any emails that were deleted or moved to another folder back to the original location. Typically, the original location is the inbox but I\'d recommend checking with the user to see if anything else moved or is out of place.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '54ggq', text: '10. Review audit logs to see if the malicious actor did anything else', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '7v8ka', text: 'Typically, performing everything above is a good measure to undo the damage and access to the malicious user but you never know. Take a quick gander at the audit logs to verify. Especially, if the user account that was compromised was an admin account. The hacker may have dropped in another account and assigned an admin role to it!', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 14, length: 1, offset: 0}], inlineStyleRanges: [], key: 'bslac', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [{key: 15, length: 5, offset: 48}], inlineStyleRanges: [{length: 35, offset: 10, style: 'BOLD'}, {length: 5, offset: 48, style: 'BOLD'}], key: 'c0kei', text: 'Go to the Microsoft 365 Defender admin center > Audit.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 11, offset: 9, style: 'BOLD'}, {length: 5, offset: 28, style: 'BOLD'}, {length: 5, offset: 49, style: 'BOLD'}, {length: 9, offset: 61, style: 'BOLD'}], key: '89u9f', text: 'Type the user\'s name in the Users box. Click the user in the drop-down.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 6, offset: 10, style: 'BOLD'}, {length: 4, offset: 20, style: 'BOLD'}], key: 'b6k9r', text: 'Enter the start and end times accordingly.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 6, offset: 6, style: 'BOLD'}, {length: 8, offset: 72, style: 'BOLD'}, {length: 9, offset: 103, style: 'BOLD'}, {length: 11, offset: 125, style: 'BOLD'}], key: '1n5oe', text: 'Click Search. The search will take 5 or more minutes to complete. Click Refresh until the search says "Completed". Click the search name.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'd4gd3', text: 'Review the logs or export to CSV for easier filtering and deleting of rows so you can scan through all the content to look for anything else the hacker did.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '80kkj', text: '11. Unblock the account to allow sending emails', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '5kgo0', text: 'Sometimes a malicious actor will get into one of your mailboxes and send a ton of spam. When Microsoft catches a mailbox sending spam they block the mailbox from sending emails. Blocking outbound emails on a mailbox is good for you and the world. It\'s good for the world because Microsoft can mitigate hackers from accessing more organizations and spreading their nonsense all over the place. It\'s good for you and your organization because it prevents damage to your company\'s reputation. Anyway, let\'s jump in and unblock the account.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 16, length: 19, offset: 53}], inlineStyleRanges: [], key: '8lt6u', text: 'Go to Microsoft 365 Defender admin center > Review > Restricted entities.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 8, offset: 34, style: 'BOLD'}, {length: 4, offset: 44, style: 'BOLD'}, {length: 6, offset: 51, style: 'BOLD'}, {length: 3, offset: 60, style: 'BOLD'}], key: 'dvla0', text: 'Click the user in the list. Click Unblock > Next > Submit > Yes.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: '8covb', text: '12. Enable MFA', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [{key: 17, length: 77, offset: 235}], inlineStyleRanges: [], key: '2m5bo', text: 'If MFA isn\'t already enabled I would recommend it. It\'s a great second line of defense in case a user has their password stolen. There are several ways to enable MFA in a tenant / for a user in Microsoft 365. That\'s already covered in The many ways to implement multi-factor authentication (MFA) in Microsoft 365. So I won\'t go into detail about it. But you really should consider enabling MFA.', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'fbhdg', text: '13. Review email apps and change availability', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'cfhca', text: 'Next up on the list of hardening your environment, is disabling unused email apps. What happens a lot of times is the hacker will gain entry into the user\'s mailbox and then set up an IMAP or a POP connection to the mailbox to send out the spam/phishing emails to everyone else. Assuming your users are using the browser or a modern application, for example, Outlook then we can go ahead and disable those email apps. You can disable the email apps using a conditional access policy but I didn\'t want to write a book so I\'m going to show you how to disable it for a user. I\'ll write another article on conditional access policies that will have that listed so stay tuned!', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 18, length: 1, offset: 0}], inlineStyleRanges: [], key: '204pt', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [{key: 19, length: 9, offset: 42}], inlineStyleRanges: [{length: 21, offset: 5, style: 'BOLD'}, {length: 11, offset: 29, style: 'BOLD'}, {length: 9, offset: 42, style: 'BOLD'}], key: '34iji', text: 'Open Exchange admin center > Recipients > Mailboxes.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 5, offset: 30, style: 'BOLD'}], key: '4ep7h', text: 'Search for, then click on the user you want to disable the email apps.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 13, offset: 10, style: 'BOLD'}, {length: 9, offset: 27, style: 'BOLD'}, {length: 4, offset: 83, style: 'BOLD'}], key: '1oi89', text: 'Click the toggle switch to Disabled for any email apps the user isn\'t using. Click Save.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 'dof7q', text: '14. Review sign-in logs and check for additional security measures you can take', type: 'header-two'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [], key: 't3rh', text: 'Finally, we have almost finished with the compromised account. The last step is looking into how the hacker breached the account and then hardening that part of Microsoft 365. Did the hacker log in from Russia? Do you do business / have users logging in from Russia? No, then create a conditional access policy limiting sign-ins from Russia. Or maybe the user account was breached because the user received a phishing email and then clicked a link and entered their credentials in a fake Microsoft 365 sign-in portal. Then set up Safe Links. To review the sign-in logs perform the following:', type: 'unstyled'}, {data: {}, depth: 0, entityRanges: [{key: 20, length: 1, offset: 0}], inlineStyleRanges: [], key: '7aa0i', text: ' ', type: 'atomic'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 45, offset: 6, style: 'BOLD'}, {length: 5, offset: 54, style: 'BOLD'}], key: 'ad4h', text: 'Go to Microsoft Azure Active Directory admin Center > Users.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 19, offset: 0, style: 'BOLD'}, {length: 5, offset: 42, style: 'BOLD'}, {length: 12, offset: 59, style: 'BOLD'}], key: '752sf', text: 'Search for the user that was breached and click on his/her display name.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [], inlineStyleRanges: [{length: 12, offset: 6, style: 'BOLD'}], key: '47a2', text: 'Click Sign in Logs.', type: 'ordered-list-item'}, {data: {}, depth: 0, entityRanges: [{key: 21, length: 12, offset: 56}], inlineStyleRanges: [], key: '7jvpc', text: 'I have a little bit more information on how to read the sign-in logs.', type: 'unstyled'}], entityMap: {0: {data: {alt: '14 steps to fix a hacked Microsoft 365 account', height: 1056, src: 'https://i.ibb.co/syxtrK4/14-steps-to-fix-a-hacked-Microsoft-365-account.png', url: 'https://admin.microsoft.com/?#/users', width: 816}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 1: {data: {alt: 'Reset a user\'s password', src: 'https://i.ibb.co/VSK8ZhQ/reset-user-password.png', url: 'https://admin.microsoft.com/?#/users'}, mutability: 'MUTABLE', type: 'LINK'}, 10: {data: {alt: 'Delete the malicious inbox rules', src: 'https://i.ibb.co/hVbJgRK/delete-inbox-rules.png', url: 'https://admin.exchange.microsoft.com/#/mailboxes'}, mutability: 'MUTABLE', type: 'LINK'}, 11: {data: {alt: 'Delete the malicious inbox rules', height: 643, src: 'https://i.ibb.co/hVbJgRK/delete-inbox-rules.png', url: 'https://outlook.office.com/mail/', width: 1234}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 12: {data: {alt: 'Disable mail forwarding in Microsoft 365 OWA', src: 'https://i.ibb.co/D92rF5W/disable-mail-forwarding.png', url: 'https://outlook.office.com/mail/'}, mutability: 'MUTABLE', type: 'LINK'}, 13: {data: {alt: 'Disable mail forwarding in Microsoft 365 OWA', height: 643, src: 'https://i.ibb.co/D92rF5W/disable-mail-forwarding.png', width: 1061}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 14: {data: {alt: 'Run an audit log search in Microsoft 365', height: 671, src: 'https://i.ibb.co/9GxtgBs/run-an-audit-log-search.png', url: 'https://security.microsoft.com/auditlogsearch', width: 1126}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 15: {data: {url: 'https://security.microsoft.com/auditlogsearch'}, mutability: 'MUTABLE', type: 'LINK'}, 16: {data: {url: 'https://security.microsoft.com/restrictedentities'}, mutability: 'MUTABLE', type: 'LINK'}, 17: {data: {alt: 'Disable email app access to exchange online', src: 'https://i.ibb.co/f21pWzc/Disable-email-app-access-to-exchange-online.png', url: 'https://www.gitbit.org/course/ms-500/learn/The-many-ways-to-implement-multi-factor-authentication-MFA-in-Microsoft-365-nAAIvNbtk'}, mutability: 'MUTABLE', type: 'LINK'}, 18: {data: {alt: 'Disable email app access to exchange online', height: 411, src: 'https://i.ibb.co/f21pWzc/Disable-email-app-access-to-exchange-online.png', url: 'https://admin.exchange.microsoft.com/#/mailboxes', width: 1252}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 19: {data: {alt: 'Review the sign in logs for a user in Microsoft 365', src: 'https://i.ibb.co/XCBVzL8/Review-the-sign-in-logs-for-a-user-in-Microsoft-365.png', url: 'https://admin.exchange.microsoft.com/#/mailboxes'}, mutability: 'MUTABLE', type: 'LINK'}, 2: {data: {alt: 'Reset a user\'s password', height: 654, src: 'https://i.ibb.co/VSK8ZhQ/reset-user-password.png', width: 794}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 20: {data: {alt: 'Review the sign in logs for a user in Microsoft 365', height: 189, src: 'https://i.ibb.co/XCBVzL8/Review-the-sign-in-logs-for-a-user-in-Microsoft-365.png', url: 'https://www.gitbit.org/course/ms-500/learn/Auditing-sign-ins-and-other-actions-in-Microsoft-365-sH_Ee1DW1', width: 464}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 21: {data: {url: 'https://www.gitbit.org/course/ms-500/learn/Auditing-sign-ins-and-other-actions-in-Microsoft-365-sH_Ee1DW1'}, mutability: 'MUTABLE', type: 'LINK'}, 3: {data: {alt: 'Sign out of all sessions', height: 510, src: 'https://i.ibb.co/kGz1T0n/sign-out-all-sessions.png', width: 794}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 4: {data: {alt: 'Remove admin roles from the hacked account', height: 657, src: 'https://i.ibb.co/0t9Cr5Z/remove-admin-roles.png', url: 'https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers', width: 794}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 5: {data: {alt: 'Microsoft 365 authentication methods', src: 'https://i.ibb.co/9HfSNqz/authentication-methods.png', url: 'https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers'}, mutability: 'MUTABLE', type: 'LINK'}, 6: {data: {alt: 'Microsoft 365 authentication methods', height: 862, src: 'https://i.ibb.co/9HfSNqz/authentication-methods.png', url: 'https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers', width: 766}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 7: {data: {alt: 'Remove any enterprise apps the hacker may have registered', height: 413, src: 'https://i.ibb.co/pRL17ch/remove-enterprise-apps.png', url: 'https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers', width: 1894}, mutability: 'IMMUTABLE', type: 'IMAGE'}, 8: {data: {alt: 'How to delegate Microsoft 365 mailbox rights to yourself', src: 'https://i.ibb.co/y6HcKyw/delegate-admin-rights-to-microsoft-365.png', url: 'https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers'}, mutability: 'MUTABLE', type: 'LINK'}, 9: {data: {alt: 'How to delegate Microsoft 365 mailbox rights to yourself', height: 690, src: 'https://i.ibb.co/y6HcKyw/delegate-admin-rights-to-microsoft-365.png', url: 'https://admin.exchange.microsoft.com/#/mailboxes', width: 1272}, mutability: 'IMMUTABLE', type: 'IMAGE'}}}, datePublished: '2022/11/12', description: '14 steps to fix a compromised Microsoft 365 account. How to lock out the intruder and harden the account so it doesn\'t happen again.', featuredImage: 'https://i.ibb.co/syxtrK4/14-steps-to-fix-a-hacked-Microsoft-365-account.png', id: 'v1hijwayc', images: ['https://i.ibb.co/VSK8ZhQ/reset-user-password.png', 'https://i.ibb.co/kGz1T0n/sign-out-all-sessions.png', 'https://i.ibb.co/0t9Cr5Z/remove-admin-roles.png', 'https://i.ibb.co/9HfSNqz/authentication-methods.png', 'https://i.ibb.co/pRL17ch/remove-enterprise-apps.png', 'https://i.ibb.co/y6HcKyw/delegate-admin-rights-to-microsoft-365.png', 'https://i.ibb.co/hVbJgRK/delete-inbox-rules.png', 'https://i.ibb.co/D92rF5W/disable-mail-forwarding.png', 'https://i.ibb.co/9GxtgBs/run-an-audit-log-search.png', 'https://i.ibb.co/f21pWzc/Disable-email-app-access-to-exchange-online.png', 'https://i.ibb.co/XCBVzL8/Review-the-sign-in-logs-for-a-user-in-Microsoft-365.png', 'https://i.ibb.co/syxtrK4/14-steps-to-fix-a-hacked-Microsoft-365-account.png'], publish: true, slug: '14-steps-to-fix-a-hacked-microsoft-365-account-v1hijwayc', title: '14 steps to fix a hacked Microsoft 365 account', type: 'article'},
      decideHeight: '1000px'
    }
  }

  componentDidMount() {
    this.mountAds1()
    this.mountAds2()
    const setDecideHeight = (a) => {
      if (!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))))
        this.setState({decideHeight: '250px'})
    }

    setDecideHeight(navigator.userAgent||navigator.vendor||window.opera)
  }

  mountAds1() {
    (function(w, d, s, i) {
      w.ldAdInit=w.ldAdInit||[]; w.ldAdInit.push({slot: 15664931508787046, size: [0, 0], id: 'ld-534-9587'}); if (!d.getElementById(i)) {
        const j=d.createElement(s); const p=d.getElementsByTagName(s)[0]; j.async=true; j.src='//cdn2.decide.dev/_js/ajs.js'; j.id=i; p.parentNode.insertBefore(j, p)
      }
    })(window, document, 'script', 'ld-ajs')
  }

  mountAds2() {
    ((w, d, s, i)=> {
      w.ldAdInit=w.ldAdInit||[]; w.ldAdInit.push({slot: 15664932884518758, size: [0, 0], id: 'ld-7740-2760'}); if (!d.getElementById(i)) {
        const j=d.createElement(s); const p=d.getElementsByTagName(s)[0]; j.async=true; j.src='//cdn2.decide.dev/_js/ajs.js'; j.id=i; p.parentNode.insertBefore(j, p)
      }
    })(window, document, 'script', 'ld-ajs')
  }

  render() {
    const jsonLd = {
      headline: this.state.article.title,
      datePublished: this.state.article.publishDate,
      keywords: [
        'Microsoft',
        'Microsoft 365',
        'Office 365',
        'MS-500',
        'Microsoft 365 Security Administration'
      ],
      author: {
        '@type': 'Person',
        name: 'John Gruber',
        url: 'https://medium.com/@gruberjl'
      }
    }

    return (
      <Page jsonLdType={'BlogPosting'} jsonLd={jsonLd} image={this.state.article.featuredImage} title={this.state.article.title} description={this.state.article.description}>
        <Container>
          <Grid container>
            <Grid item>
              <main>
                <div id="ld-534-9587" style={{height: this.state.decideHeight, overflow: 'hidden'}}>
                  <p style="position: absolute;">Reserved for ads. Please scroll down.</p>
                </div>
                <h1 style={marginTop24Style}>{this.state.article.title}</h1>
                <div><p />
                  <img src="https://i.ibb.co/syxtrK4/14-steps-to-fix-a-hacked-Microsoft-365-account.png" alt="14 steps to fix a hacked Microsoft 365 account" height="1056" width="816" style="aspect-ratio: auto 816 / 1056; height: auto;" />
                  <p>The first 6 steps are all about getting the malicious actor out of the account. The next 5 steps are all about undoing the damage that was done to your Microsoft 365 tenant. The final 3 steps are all about hardening the account so it doesn't happen again. Here's a quick checklist you can use to lock out the hacker. Then you can scroll down to the appropriate section to learn how / why to perform the steps.</p>
                  <ol>
                    <li>Reset account password</li>
                    <li>Sign out of all sessions</li>
                    <li>Remove the account from admin roles</li>
                    <li>Re-enroll MFA</li>
                    <li>Check for enterprise apps authorized for the user</li>
                    <li>Scan devices for malware</li>
                    <li>Review mailbox rules</li>
                    <li>Review mail forwarding</li>
                    <li>Move any emails that were deleted/moved to a new folder</li>
                    <li>Review audit logs for any other unusual activity</li>
                    <li>Unblock the account to allow sending emails</li>
                    <li>Enable MFA</li>
                    <li>Review email apps and change availability</li>
                    <li>Review sign-in logs and check for additional security measures you can take</li>
                  </ol>
                  <div id="ld-7740-2760" style={{height: this.state.decideHeight, overflow: 'hidden'}} /><h2>1. Reset account password</h2>
                  <p>First and foremost is locking the hacker out of the account. Reset the password! If it's a cloud-only account you can reset the user password right from the Microsoft 365 admin center. If it's a synced account you'll need to reset the password from your on-premises Active Directory.</p>
                  <ol>
                    <li>Go to <strong>Microsoft 365 admin center</strong> &gt; <strong>Users </strong>&gt; <a href="https://admin.microsoft.com/?#/users" target="_self"><strong>Active Users</strong></a>.</li>
                    <li><strong>Search for the user</strong> you want to reset the password for.</li>
                    <li>Click the <strong>Display name</strong> of the account.</li>
                    <li>Click <strong>Reset password</strong>.</li>
                    <li>Set the password/options as you feel fit and click <strong>Reset password</strong>.</li>
                  </ol>
                  <img src="https://i.ibb.co/VSK8ZhQ/reset-user-password.png" alt="Reset a user's password" height="654" width="794" style="aspect-ratio: auto 794 / 654; height: auto;" />
                  <h2>&nbsp;2. Sign out of all sessions</h2>
                  <p>In short, a session is created every time a user signs into Microsoft 365 on any device/app. What happens is the user will provide the username/password. Microsoft will authorize the connection and then create a session. The device or app will receive an identifying key. Microsoft 365 will hold that key on their end to authorize the app every time the app wants to interact with Microsoft 365. That way the app doesn't need to send the password every time it is communicating with Microsoft 365. Disconnecting all the user's sessions will require the user to sign in on all their devices and apps again.</p>
                  <ol>
                    <li>Go to <strong>Microsoft 365 admin center</strong> &gt; <strong>Users </strong>&gt; <a href="https://admin.microsoft.com/?#/users" target="_self"><strong>Active Users</strong></a>.</li>
                    <li><strong>Search for the user</strong> you want to reset the password for.</li>
                    <li>Click the <strong>Display name</strong> of the account.</li>
                    <li>Click Sign out of all sessions.</li>
                  </ol>
                  <img src="https://i.ibb.co/kGz1T0n/sign-out-all-sessions.png" alt="Sign out of all sessions" height="510" width="794" style="aspect-ratio: auto 794 / 510; height: auto;" />
                  <h2>3. Remove the account from admin roles</h2>
                  <p>Next, we may want to remove the account from any admin roles. It's good practice to temporarily remove the account from any admin roles until you are 100% sure the compromised account is no longer accessed by the hacker.</p>
                  <ol>
                    <li>Go to <strong>Microsoft 365 admin center</strong> &gt; <strong>Users </strong>&gt; <a href="https://admin.microsoft.com/?#/users" target="_self"><strong>Active Users</strong></a>.</li>
                    <li><strong>Search for the user</strong> you want to reset the password for.</li>
                    <li>Click the <strong>Display name</strong> of the account.</li>
                    <li>Click <strong>Manage roles</strong> &gt; <strong>User (no admin center access)</strong> &gt; <strong>Save changes</strong>.</li>
                  </ol>
                  <img src="https://i.ibb.co/0t9Cr5Z/remove-admin-roles.png" alt="Remove admin roles from the hacked account" height="657" width="794" style="aspect-ratio: auto 794 / 657; height: auto;" />
                  <h2>4. Re-enroll in MFA</h2>
                  <p>If you have MFA enabled for the user you may want to re-enroll the devices or at least review the devices and make sure they are the user's devices. In short, once a malicious user has access to the user's Microsoft 365 account they can enroll their own devices and possibly reset the password after you've changed the password. So go to the user's MFA authentication methods and sit down with the user and ask if that's their authentication method.</p>
                  <ol>
                    <li>Go to <strong>Azure Active Directory</strong> &gt; <a href="https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers" target="_self"><strong>Users</strong></a>. Search for the user, then click the <strong>user's display name</strong>.</li>
                    <li>Click <strong>Authentication methods</strong> then view the user's authentication methods.</li>
                  </ol>
                  <img src="https://i.ibb.co/9HfSNqz/authentication-methods.png" alt="Microsoft 365 authentication methods" height="862" width="766" style="aspect-ratio: auto 766 / 862; height: auto;" />
                  <h2>5. Check for enterprise apps authorized for the user</h2>
                  <p>Another way a malicious actor may retain access to your user's Microsoft 365 account is through enterprise apps. In short, once a person has access to the account they may register the user for a malicious enterprise app that the hacker can use to retain access to the account after the password reset. So we'll need to review the registered apps for the user.</p>
                  <img src="https://i.ibb.co/pRL17ch/remove-enterprise-apps.png" alt="Remove any enterprise apps the hacker may have registered" height="413" width="1894" style="aspect-ratio: auto 1894 / 413; height: auto;" />
                  <ol>
                    <li>Go to <strong>Azure Active Directory</strong> &gt; <a href="https://aad.portal.azure.com/#view/Microsoft_AAD_UsersAndTenants/UserManagementMenuBlade/~/AllUsers" target="_self"><strong>Users</strong></a> &gt; <strong>Search</strong> for then <strong>click </strong>the <strong>user's name</strong>.</li>
                    <li>Click <strong>Applications</strong>.</li>
                    <li><strong>Sort </strong>the list by <strong>date</strong>.</li>
                    <li><strong>Find any apps</strong> that were registered since the hacker gained access to the account.</li>
                    <li>Click the <strong>app name</strong>.</li>
                    <li>Click <strong>Remove</strong>.</li>
                  </ol>
                  <h2>6. Scan devices for malware</h2>
                  <p>It isn't very common but I have had an issue where we cleaned the Microsoft 365 account, changed the password, unblocked the account, and then had the malicious actor back in the account! How did they do it? They had malware on the user's computer. So be sure to scan all the user's devices for malware. Check for any weird apps in the startup of the computer and check for any strange services.</p>
                  <h2>7. Review mailbox inbox rules</h2>
                  <p>One this hackers like to do once they gain access to one of your mailboxes is send a lot of phishing/spam emails. Of course, sending these emails will return a lot of undeliverable emails and emails from recipients saying things like "Is this legit?". So One of the ways hackers found to cover their tracks is by creating a mail flow rule that will automatically delete any emails the user receives. There are 2 ways to check for the rules, using the GUI or using PowerShell. Typically, people find the GUI to be more readable so we'll use that route below. First, you'll need to grant yourself full access to the mailbox. Then, you'll need to check for the inbox rules. Finally, you'll need to remove your full access to the mailbox.</p>
                  <h3>Grant yourself admin rights to the mailbox</h3>
                  <img src="https://i.ibb.co/y6HcKyw/delegate-admin-rights-to-microsoft-365.png" alt="How to delegate Microsoft 365 mailbox rights to yourself" height="690" width="1272" style="aspect-ratio: auto 1272 / 690; height: auto;" />
                  <ol>
                    <li>Open the <strong>Exchange admin center</strong> &gt; <strong>Recipients </strong>&gt; <a href="https://admin.exchange.microsoft.com/#/mailboxes" target="_self"><strong>Mailboxes</strong></a>.</li>
                    <li><strong>Search </strong>for and <strong>click</strong> the <strong>Display Name</strong> of the user that's been compromised.</li>
                    <li>Click <strong>Delegation </strong>&gt; <strong>Edit </strong>(located under Read and manage)</li>
                    <li>Click <strong>Add members</strong> &gt; Click the <strong>checkbox </strong>next to your <strong>admin account</strong>. Click <strong>Save</strong>.</li>
                  </ol>
                  <h3>Check the inbox rules</h3>
                  <img src="https://i.ibb.co/hVbJgRK/delete-inbox-rules.png" alt="Delete the malicious inbox rules" height="643" width="1234" style="aspect-ratio: auto 1234 / 643; height: auto;" />
                  <ol>
                    <li>Open <a href="https://outlook.office.com/mail/" target="_self">Outlook OWA</a> &gt; Click your <strong>profile icon</strong> in the top right. Click <strong>Open another mailbox</strong>.</li>
                    <li>Type the user's <strong>display name</strong> in the box provided. Click the <strong>user </strong>that appears in the <strong>dropdown</strong>. Click <strong>Open</strong>.</li>
                    <li>Click the <strong>settings </strong>gear in the top right &gt; <strong>View all Outlook settings</strong>.</li>
                    <li>Go to <strong>Rules </strong>&gt; Click the <strong>trash </strong>can next to every rule that you want to delete. Click <strong>OK</strong>.</li>
                  </ol>
                  <p>Before you remove your delegated permissions you should check for mail forwarding. The steps are below.</p>
                  <h2>8. Review mail forwarding</h2>
                  <p>Another thing hackers like to do when they gain access to your mailbox is set up mail forwarding. In short, they may use your account to send phishing attacks to other organizations and request information from other people. So we'll need to disable any mail forwarding the hacker has set up.</p>
                  <img src="https://i.ibb.co/D92rF5W/disable-mail-forwarding.png" alt="Disable mail forwarding in Microsoft 365 OWA" height="643" width="1061" style="aspect-ratio: auto 1061 / 643; height: auto;" />
                  <ol>
                    <li>Open <a href="https://outlook.office.com/mail/" target="_self">Outlook OWA</a> &gt; Click your <strong>profile icon</strong> in the top right. Click <strong>Open another mailbox</strong>.</li>
                    <li>Type the user's <strong>display name</strong> in the box provided. Click the <strong>user </strong>that appears in the <strong>dropdown</strong>. Click <strong>Open</strong>.</li>
                    <li>Click the <strong>settings </strong>gear in the top right &gt; <strong>View all Outlook settings</strong>.</li>
                    <li>Click <strong>Forwarding </strong>&gt; <strong>uncheck Enable forwarding</strong>. Click <strong>Save</strong>.</li>
                  </ol>
                  <p>Don't remove those permissions just yet. If you did find an inbox rule or a forwarding rule we'll need to undo the damage!</p>
                  <h2>9. Move any emails that were deleted/moved to a new folder</h2>
                  <p>In short, you'll need to move any emails that were deleted or moved to another folder back to the original location. Typically, the original location is the inbox but I'd recommend checking with the user to see if anything else moved or is out of place.</p>
                  <h2>10. Review audit logs to see if the malicious actor did anything else</h2>
                  <p>Typically, performing everything above is a good measure to undo the damage and access to the malicious user but you never know. Take a quick gander at the audit logs to verify. Especially, if the user account that was compromised was an admin account. The hacker may have dropped in another account and assigned an admin role to it!</p>
                  <img src="https://i.ibb.co/9GxtgBs/run-an-audit-log-search.png" alt="Run an audit log search in Microsoft 365" height="671" width="1126" style="aspect-ratio: auto 1126 / 671; height: auto;" />
                  <ol>
                    <li>Go to the <strong>Microsoft 365 Defender admin center</strong> &gt; <a href="https://security.microsoft.com/auditlogsearch" target="_self"><strong>Audit</strong></a>.</li>
                    <li>Type the <strong>user's name</strong> in the <strong>Users</strong> box. Click the <strong>user </strong>in the <strong>drop-down</strong>.</li>
                    <li>Enter the <strong>start </strong>and <strong>end </strong>times accordingly.</li>
                    <li>Click <strong>Search</strong>. The search will take 5 or more minutes to complete. Click <strong>Refresh </strong>until the search says "<strong>Completed</strong>". Click the <strong>search name</strong>.</li>
                  </ol>
                  <p>Review the logs or export to CSV for easier filtering and deleting of rows so you can scan through all the content to look for anything else the hacker did.</p>
                  <h2>11. Unblock the account to allow sending emails</h2>
                  <p>Sometimes a malicious actor will get into one of your mailboxes and send a ton of spam. When Microsoft catches a mailbox sending spam they block the mailbox from sending emails. Blocking outbound emails on a mailbox is good for you and the world. It's good for the world because Microsoft can mitigate hackers from accessing more organizations and spreading their nonsense all over the place. It's good for you and your organization because it prevents damage to your company's reputation. Anyway, let's jump in and unblock the account.</p>
                  <ol>
                    <li>Go to Microsoft 365 Defender admin center &gt; Review &gt; <a href="https://security.microsoft.com/restrictedentities" target="_self">Restricted entities</a>.</li>
                    <li>Click the user in the list. Click <strong>Unblock </strong>&gt; <strong>Next</strong> &gt; <strong>Submit</strong> &gt; <strong>Yes</strong>.</li>
                  </ol>
                  <h2>12. Enable MFA</h2>
                  <p>If MFA isn't already enabled I would recommend it. It's a great second line of defense in case a user has their password stolen. There are several ways to enable MFA in a tenant / for a user in Microsoft 365. That's already covered in <a href="https://www.gitbit.org/course/ms-500/learn/The-many-ways-to-implement-multi-factor-authentication-MFA-in-Microsoft-365-nAAIvNbtk" target="_self">The many ways to implement multi-factor authentication (MFA) in Microsoft 365</a>. So I won't go into detail about it. But you really should consider enabling MFA.</p>
                  <h2>13. Review email apps and change availability</h2>
                  <p>Next up on the list of hardening your environment, is disabling unused email apps. What happens a lot of times is the hacker will gain entry into the user's mailbox and then set up an IMAP or a POP connection to the mailbox to send out the spam/phishing emails to everyone else. Assuming your users are using the browser or a modern application, for example, Outlook then we can go ahead and disable those email apps. You can disable the email apps using a conditional access policy but I didn't want to write a book so I'm going to show you how to disable it for a user. I'll write another article on conditional access policies that will have that listed so stay tuned!</p>
                  <img src="https://i.ibb.co/f21pWzc/Disable-email-app-access-to-exchange-online.png" alt="Disable email app access to exchange online" height="411" width="1252" style="aspect-ratio: auto 1252 / 411; height: auto;" />
                  <ol>
                    <li>Open <strong>Exchange admin center</strong> &gt; <strong>Recipients </strong>&gt; <a href="https://admin.exchange.microsoft.com/#/mailboxes" target="_self"><strong>Mailboxes</strong></a>.</li>
                    <li>Search for, then click on the <strong>user </strong>you want to disable the email apps.</li>
                    <li>Click the <strong>toggle switch</strong> to <strong>Disabled </strong>for any email apps the user isn't using. Click <strong>Save</strong>.</li>
                  </ol>
                  <h2>14. Review sign-in logs and check for additional security measures you can take</h2>
                  <p>Finally, we have almost finished with the compromised account. The last step is looking into how the hacker breached the account and then hardening that part of Microsoft 365. Did the hacker log in from Russia? Do you do business / have users logging in from Russia? No, then create a conditional access policy limiting sign-ins from Russia. Or maybe the user account was breached because the user received a phishing email and then clicked a link and entered their credentials in a fake Microsoft 365 sign-in portal. Then set up Safe Links. To review the sign-in logs perform the following:</p>
                  <img src="https://i.ibb.co/XCBVzL8/Review-the-sign-in-logs-for-a-user-in-Microsoft-365.png" alt="Review the sign in logs for a user in Microsoft 365" height="189" width="464" style="aspect-ratio: auto 464 / 189; height: auto;" />
                  <ol>
                    <li>Go to <strong>Microsoft Azure Active Directory admin Center</strong> &gt; <strong>Users</strong>.</li>
                    <li><strong>Search for the user</strong> that was breached and <strong>click</strong> on his/her <strong>display name</strong>.</li>
                    <li>Click <strong>Sign in Logs</strong>.</li>
                  </ol>
                  <p>I have a little bit more information on how to read the <a href="https://www.gitbit.org/course/ms-500/learn/Auditing-sign-ins-and-other-actions-in-Microsoft-365-sH_Ee1DW1" target="_self">sign-in logs</a>.</p>
                </div>
              </main>
            </Grid>
          </Grid>
        </Container>
      </Page>
    )
  }
}

export default ArticlePage
